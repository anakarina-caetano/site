---
title: "rfbCNPJ: Repositório de CNPJs da Receita"
date: "2018-05-13T00:00:00+00:00"
tags: ["musica"]
categories: ["análises", "pacotes", "r"]
banner: "img/banners/rfbCNPJ.png"
author: ["Julio"]
summary: "Durante nosso último curso de introdução a programação em R, um aluno me pediu ajuda para carregar os dados de CNPJs da Receita Federal. Eu me animei tanto com essa base que decidi montar um pacotinho para baixar ler e organizar esses dados..."
draft: false
---

<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<link href="/rmarkdown-libs/wordcloud2/wordcloud.css" rel="stylesheet" />
<script src="/rmarkdown-libs/wordcloud2/wordcloud2-all.js"></script>
<script src="/rmarkdown-libs/wordcloud2/hover.js"></script>
<script src="/rmarkdown-libs/wordcloud2-binding/wordcloud2.js"></script>


<p>Durante nosso <a href="http://loja.curso-r.com">último curso de introdução a programação em R</a>, o <a href="https://github.com/reichaves">Reinaldo Chaves</a> me pediu ajuda para carregar os dados de <a href="http://idg.receita.fazenda.gov.br/orientacao/tributaria/cadastros/cadastro-nacional-de-pessoas-juridicas-cnpj/dados-abertos-do-cnpj">CNPJs da Receita Federal</a>. Eu me animei tanto com essa base que decidi montar um pacotinho para baixar ler e organizar esses dados.</p>
<div id="pacote" class="section level1">
<h1>Pacote</h1>
<p>O pacote <a href="https://github.com/jtrecenti/rfbCNPJ"><code>rfbCNPJ</code></a> baixa e lê os arquivos contendo a lista de todas as empresas do Brasil, disponibilizado pela <a href="http://idg.receita.fazenda.gov.br/orientacao/tributaria/cadastros/cadastro-nacional-de-pessoas-juridicas-cnpj/dados-abertos-do-cnpj">Receita Federal em 15 de dezembro de 2017</a>.</p>
<p>São duas tabelas separadas por UF: i) <code>empresas</code>, contendo informações de CNPJ e nome da empresa e ii) <code>socios</code>, contendo quadro de sócios. Essa base de dados é atualizada pela própria RFB e não faço ideia de quando será atualizada novamente.</p>
<p>Como os arquivos são do tipo <a href="https://readr.tidyverse.org/reference/read_fwf.html">fixed width</a>, algumas pessoas podem ter dificuldade para ler e empilhar os arquivos no R. Esse pacote facilita as operações de download e leitura.</p>
<div id="instalacao" class="section level2">
<h2>Instalação</h2>
<p>Você pode instalar o pacote <code>rfbCNPJ</code> do CRAN rodando</p>
<pre class="r"><code>install.packages(&quot;rfbCNPJ&quot;)</code></pre>
<p>Você também pode baixar diretamente do GitHub rodando:</p>
<pre class="r"><code># install.packages(&quot;devtools&quot;)
devtools::install_github(&quot;jtrecenti/rfbCNPJ&quot;)</code></pre>
</div>
<div id="download-de-arquivos-brutos" class="section level2">
<h2>Download de arquivos brutos</h2>
<p>Você pode baixar o arquivo <code>.txt</code> bruto de cada UF usando o comando <code>rfb_download()</code>. Por padrão, temos <code>ufs = NULL</code>, que baixará os arquivos de todas as UFs. Esses arquivos somam aproximadamente 4.8 GB em disco.</p>
<pre class="r"><code>rfb_download(ufs = c(&quot;AC&quot;, &quot;RR&quot;), path = &quot;caminho/da/pasta&quot;)</code></pre>
</div>
<div id="parse" class="section level2">
<h2>Parse</h2>
<p>A partir de uma pasta contendo os arquivos txt, você pode carregar as bases de dados rodando <code>rfb_read()</code> com os caminhos dos arquivos ou <code>rfb_read_dir()</code> diretamente para ler todos os arquivos da pasta. Certifique-se de que a pasta que contém os arquivos a serem lidos contém apenas os arquivos baixados em <code>.txt</code>.</p>
<pre class="r"><code>path &lt;- &quot;caminho/da/pasta&quot;
all_files &lt;- fs::dir_ls(path)

dados &lt;- rfb_read(all_files)
dados &lt;- rfb_read_fir(path) # equivalente</code></pre>
</div>
<div id="carregando-dados" class="section level2">
<h2>Carregando dados</h2>
<p>Os dados são carregados numa tabela complexa com duas <em>list-columns</em>.</p>
<pre class="r"><code>library(tibble)
print(dados, n = 27)</code></pre>
<pre><code># A tibble: 27 x 3
   file         empresa                  socio                   
   &lt;chr&gt;        &lt;list&gt;                   &lt;list&gt;                  
 1 D71214AC.txt &lt;tibble [15,690 × 3]&gt;    &lt;tibble [26,268 × 6]&gt;   
 2 D71214AL.txt &lt;tibble [60,067 × 3]&gt;    &lt;tibble [109,762 × 6]&gt;  
 3 D71214AM.txt &lt;tibble [64,306 × 3]&gt;    &lt;tibble [121,095 × 6]&gt;  
 4 D71214AP.txt &lt;tibble [15,941 × 3]&gt;    &lt;tibble [28,063 × 6]&gt;   
 5 D71214BA.txt &lt;tibble [422,396 × 3]&gt;   &lt;tibble [787,637 × 6]&gt;  
 6 D71214CE.txt &lt;tibble [193,654 × 3]&gt;   &lt;tibble [352,841 × 6]&gt;  
 7 D71214DF.txt &lt;tibble [194,734 × 3]&gt;   &lt;tibble [368,607 × 6]&gt;  
 8 D71214ES.txt &lt;tibble [179,150 × 3]&gt;   &lt;tibble [354,358 × 6]&gt;  
 9 D71214GO.txt &lt;tibble [328,524 × 3]&gt;   &lt;tibble [619,810 × 6]&gt;  
10 D71214MA.txt &lt;tibble [123,736 × 3]&gt;   &lt;tibble [201,854 × 6]&gt;  
11 D71214MG.txt &lt;tibble [962,930 × 3]&gt;   &lt;tibble [1,916,405 × 6]&gt;
12 D71214MS.txt &lt;tibble [102,208 × 3]&gt;   &lt;tibble [189,673 × 6]&gt;  
13 D71214MT.txt &lt;tibble [141,464 × 3]&gt;   &lt;tibble [262,358 × 6]&gt;  
14 D71214PA.txt &lt;tibble [159,079 × 3]&gt;   &lt;tibble [274,004 × 6]&gt;  
15 D71214PB.txt &lt;tibble [79,275 × 3]&gt;    &lt;tibble [138,596 × 6]&gt;  
16 D71214PE.txt &lt;tibble [224,184 × 3]&gt;   &lt;tibble [426,520 × 6]&gt;  
17 D71214PI.txt &lt;tibble [61,627 × 3]&gt;    &lt;tibble [105,008 × 6]&gt;  
18 D71214PR.txt &lt;tibble [708,109 × 3]&gt;   &lt;tibble [1,392,658 × 6]&gt;
19 D71214RJ.txt &lt;tibble [843,040 × 3]&gt;   &lt;tibble [1,708,931 × 6]&gt;
20 D71214RN.txt &lt;tibble [80,562 × 3]&gt;    &lt;tibble [150,411 × 6]&gt;  
21 D71214RO.txt &lt;tibble [62,385 × 3]&gt;    &lt;tibble [109,774 × 6]&gt;  
22 D71214RR.txt &lt;tibble [11,908 × 3]&gt;    &lt;tibble [21,737 × 6]&gt;   
23 D71214RS.txt &lt;tibble [670,093 × 3]&gt;   &lt;tibble [1,350,159 × 6]&gt;
24 D71214SC.txt &lt;tibble [498,511 × 3]&gt;   &lt;tibble [974,351 × 6]&gt;  
25 D71214SE.txt &lt;tibble [63,303 × 3]&gt;    &lt;tibble [114,081 × 6]&gt;  
26 D71214SP.txt &lt;tibble [2,730,412 × 3]&gt; &lt;tibble [5,585,988 × 6]&gt;
27 D71214TO.txt &lt;tibble [51,629 × 3]&gt;    &lt;tibble [89,911 × 6]&gt;</code></pre>
<p>A primeira coluna complexa mostra dados das empresas, e a segunda mostra dados dos sócios. Para carregar uma dessas listas, use <code>tidyr::unnest()</code>.</p>
<p>Empresas: (nesse caso, <code>dados</code> representa a base completa da receita).</p>
<pre class="r"><code>library(magrittr)

empresas &lt;- dados %&gt;% 
  dplyr::select(file, empresa) %&gt;% 
  tidyr::unnest(empresa)
  
empresas</code></pre>
<pre><code># A tibble: 9,048,917 x 4
   file         tipo  cnpj           nome_empresarial                    
   &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt;          &lt;chr&gt;                               
 1 D71214AC.txt 01    07398403000180 BOI GORDO AGROPECUARIA COMERCIO E R…
 2 D71214AC.txt 01    03173169000131 CONSELHO ESCOLAR BOM JESUS          
 3 D71214AC.txt 01    07399184000153 D &amp; A SOLUCOES INFORMATICA LTDA - ME
 4 D71214AC.txt 01    07399188000131 SOCIEDADE AGRICOLA POERINHA         
 5 D71214AC.txt 01    03300047000169 ASSOCIACAO MAO AMIGA DE PRODUTORES …
 6 D71214AC.txt 01    04940648000107 ASSOCIACAO DOS PRODUTORES RURAIS E …
 7 D71214AC.txt 01    04940653000101 CONSELHO ESCOLAR POLO HORTIGRANJEIRO
 8 D71214AC.txt 01    04940654000156 CONSELHO ESCOLAR CENTRO EDUCACIONAL…
 9 D71214AC.txt 01    03301098000105 ASSOCIACAO AGROEXTRATIVISTA SANTOS …
10 D71214AC.txt 01    01653480000152 DENEVS - TERCEIRIZACAO LTDA         
# ... with 9,048,907 more rows
</code></pre>
<p>Sócios:</p>
<pre class="r"><code>socios &lt;- dados %&gt;% 
  dplyr::select(file, socio) %&gt;% 
  tidyr::unnest(socio)
  
socios</code></pre>
<pre><code># A tibble: 17,780,860 x 7
   file   tipo  cnpj  indicador_cpf_c… cpf_cnpj_socio qualificacao nome  
   &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;            &lt;chr&gt;          &lt;chr&gt;        &lt;chr&gt; 
 1 D7121… 02    0739… 2                NA             49           SELMA…
 2 D7121… 02    0739… 2                NA             22           MARCE…
 3 D7121… 02    0317… 2                NA             16           MARIA…
 4 D7121… 02    0739… 2                NA             49           DILSO…
 5 D7121… 02    0739… 2                NA             22           ANGEL…
 6 D7121… 02    0739… 2                NA             16           RAIMU…
 7 D7121… 02    0330… 2                NA             16           MOISE…
 8 D7121… 02    0494… 2                NA             16           RAIMU…
 9 D7121… 02    0494… 2                NA             16           MARIA…
10 D7121… 02    0494… 2                NA             16           EUCLI…
# ... with 17,780,850 more rows
</code></pre>
<p>A descrição das qualificações pode ser encontrada na base <code>qualificacao</code>, disponível dentro do pacote:</p>
<pre class="r"><code>data(qualificacao, package = &quot;rfbCNPJ&quot;)

qualificacao</code></pre>
<pre><code># A tibble: 40 x 2
   qualificacao qualificacao_nm             
   &lt;chr&gt;        &lt;chr&gt;                       
 1 05           Administrador               
 2 08           Conselheiro de Administração
 3 10           Diretor                     
 4 16           Presidente                  
 5 17           Procurador                  
 6 20           Sociedade Consorciada       
 7 21           Sociedade Filiada           
 8 22           Sócio                       
 9 23           Sócio Capitalista           
10 24           Sócio Comanditado           
# ... with 30 more rows</code></pre>
<p>Para juntar com a base de dados dos sócios, basta dar <code>dplyr::inner_join()</code>!</p>
</div>
<div id="download-de-arquivos-binarios" class="section level2">
<h2>Download de arquivos binários</h2>
<p>Você pode carregar os arquivos binários (em <code>.rds</code>) diretamente da web usando a função <code>rfb_import()</code>. Essa função baixa os arquivos binários diretamente do <a href="https://www.dropbox.com/sh/tneczglkt11co0b/AABuRuJR02w2QcUbuhSl1XvLa?dl=0">Dropbox</a>. Você pode baixar usando o parâmetro <code>type=</code>, com as opções “all” (<code>tibble</code> complexa com <em>list-columns</em>), “empresas” (<code>tibble</code> retangular) e “socios” (<code>tibble</code> retangular).</p>
<pre class="r"><code>empresas &lt;- rfb_import(&quot;empresas&quot;)</code></pre>
<p>Você também pode baixar os dados dos arquivos binários em <code>.rds</code> desses links com arquivos armazenados diretamente no dropbox:</p>
<ul>
<li><a href="https://www.dropbox.com/s/js3lvm0ogpxcjch/rfb.rds?dl=1">rfb (list-column)</a></li>
<li><a href="https://www.dropbox.com/s/9h06mn9rzml4d2h/rfb_empresas.rds?dl=1">empresas</a></li>
<li><a href="https://www.dropbox.com/s/67rs8fiv77gu73f/rfb_socios.rds?dl=1">socios</a></li>
</ul>
<p>Para ler um desses arquivos, basta rodar</p>
<pre class="r"><code>dados &lt;- readRDS(&quot;caminho/para/dados.rds&quot;)</code></pre>
<hr />
</div>
</div>
<div id="analises" class="section level1">
<h1>Análises</h1>
<p>Vamos brincar um pouco com esses dados?</p>
<div id="empresas-por-uf" class="section level2">
<h2>Empresas por UF</h2>
<p>Minha hipótese inicial era que o estado com maior quantidade de CNPJs por pessoa era SP. Mas isso não é verdade! Os estados do Sul estão dominando, junto com DF. São Paulo aparece apenas na quarta posição.</p>
<pre class="r"><code>
# você pode baixar o `abjData` do GitHub rodando
# devtools::install_github(&quot;abjur/abjData&quot;)

# relação de códigos de UF e UFs
cods &lt;- abjData::cadmun %&gt;% 
  dplyr::select(uf_sigla = uf, uf_cod = UFCOD) %&gt;% 
  dplyr::distinct()
# População de cada UF
pop &lt;- abjData::pnud_uf %&gt;% 
  dplyr::filter(ano == 2010) %&gt;% 
  dplyr::inner_join(cods, c(&quot;uf&quot; = &quot;uf_cod&quot;)) %&gt;% 
  dplyr::select(uf_sigla, popt)

# fazendo o join das bases!
empresas %&gt;% 
  dplyr::mutate(uf_sigla = stringr::str_extract(
    file, &quot;([A-Z]{2})(?=\\.txt)&quot;)) %&gt;% 
  dplyr::inner_join(pop, &quot;uf_sigla&quot;) %&gt;%
  # calculando a razão entre população e quantidade de empresas
  dplyr::group_by(uf_sigla) %&gt;% 
  dplyr::summarise(n = n(), 
                   pop = dplyr::first(popt),
                   prop = n / pop) %&gt;% 
  dplyr::arrange(dplyr::desc(prop)) %&gt;% 
  dplyr::mutate(prop = scales::percent(prop)) %&gt;% 
  knitr::kable()
</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">UF</th>
<th align="right">Qtd. Empresas</th>
<th align="right">População</th>
<th align="left">Proporção</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">SC</td>
<td align="right">498511</td>
<td align="right">6199948</td>
<td align="left">8.04%</td>
</tr>
<tr class="even">
<td align="left">DF</td>
<td align="right">194734</td>
<td align="right">2541714</td>
<td align="left">7.66%</td>
</tr>
<tr class="odd">
<td align="left">PR</td>
<td align="right">708109</td>
<td align="right">10348243</td>
<td align="left">6.84%</td>
</tr>
<tr class="even">
<td align="left">SP</td>
<td align="right">2730412</td>
<td align="right">40915382</td>
<td align="left">6.67%</td>
</tr>
<tr class="odd">
<td align="left">RS</td>
<td align="right">670093</td>
<td align="right">10593366</td>
<td align="left">6.33%</td>
</tr>
<tr class="even">
<td align="left">GO</td>
<td align="right">328524</td>
<td align="right">5934767</td>
<td align="left">5.54%</td>
</tr>
<tr class="odd">
<td align="left">RJ</td>
<td align="right">843040</td>
<td align="right">15871448</td>
<td align="left">5.31%</td>
</tr>
<tr class="even">
<td align="left">ES</td>
<td align="right">179150</td>
<td align="right">3477472</td>
<td align="left">5.15%</td>
</tr>
<tr class="odd">
<td align="left">MG</td>
<td align="right">962930</td>
<td align="right">19383604</td>
<td align="left">4.97%</td>
</tr>
<tr class="even">
<td align="left">MT</td>
<td align="right">141464</td>
<td align="right">2961977</td>
<td align="left">4.78%</td>
</tr>
<tr class="odd">
<td align="left">MS</td>
<td align="right">102208</td>
<td align="right">2404628</td>
<td align="left">4.25%</td>
</tr>
<tr class="even">
<td align="left">RO</td>
<td align="right">62385</td>
<td align="right">1515025</td>
<td align="left">4.12%</td>
</tr>
<tr class="odd">
<td align="left">TO</td>
<td align="right">51629</td>
<td align="right">1349770</td>
<td align="left">3.83%</td>
</tr>
<tr class="even">
<td align="left">SE</td>
<td align="right">63303</td>
<td align="right">2038459</td>
<td align="left">3.11%</td>
</tr>
<tr class="odd">
<td align="left">BA</td>
<td align="right">422396</td>
<td align="right">13755200</td>
<td align="left">3.07%</td>
</tr>
<tr class="even">
<td align="left">RR</td>
<td align="right">11908</td>
<td align="right">421159</td>
<td align="left">2.83%</td>
</tr>
<tr class="odd">
<td align="left">PE</td>
<td align="right">224184</td>
<td align="right">8646409</td>
<td align="left">2.59%</td>
</tr>
<tr class="even">
<td align="left">RN</td>
<td align="right">80562</td>
<td align="right">3127820</td>
<td align="left">2.58%</td>
</tr>
<tr class="odd">
<td align="left">AP</td>
<td align="right">15941</td>
<td align="right">652768</td>
<td align="left">2.44%</td>
</tr>
<tr class="even">
<td align="left">CE</td>
<td align="right">193654</td>
<td align="right">8317604</td>
<td align="left">2.33%</td>
</tr>
<tr class="odd">
<td align="left">AC</td>
<td align="right">15690</td>
<td align="right">690774</td>
<td align="left">2.27%</td>
</tr>
<tr class="even">
<td align="left">PA</td>
<td align="right">159079</td>
<td align="right">7247979</td>
<td align="left">2.19%</td>
</tr>
<tr class="odd">
<td align="left">PB</td>
<td align="right">79275</td>
<td align="right">3706991</td>
<td align="left">2.14%</td>
</tr>
<tr class="even">
<td align="left">PI</td>
<td align="right">61627</td>
<td align="right">3050838</td>
<td align="left">2.02%</td>
</tr>
<tr class="odd">
<td align="left">AL</td>
<td align="right">60067</td>
<td align="right">3045851</td>
<td align="left">1.97%</td>
</tr>
<tr class="even">
<td align="left">MA</td>
<td align="right">123736</td>
<td align="right">6317987</td>
<td align="left">1.96%</td>
</tr>
<tr class="odd">
<td align="left">AM</td>
<td align="right">64306</td>
<td align="right">3301221</td>
<td align="left">1.95%</td>
</tr>
</tbody>
</table>
</div>
<div id="wordcloud-dos-nomes-das-empresas" class="section level2">
<h2>Wordcloud dos nomes das empresas</h2>
<pre class="r"><code>
# palavras banidas: stop words e alguns tipos empresariais
banned_words &lt;- c(
  tm::stopwords(&quot;en&quot;), 
  tm::stopwords(&quot;pt-br&quot;),
  &quot;ltda&quot;, &quot;eireli&quot;, &quot;epp&quot;, &quot;associacao&quot;
)

wc_data &lt;- empresas %&gt;% 
  # separa as palavras
  tidytext::unnest_tokens(word, nome_empresarial) %&gt;% 
  dplyr::count(word) %&gt;%
  # tirar palavras banidas, 
  # palavras com tamanho menor ou igual a 2
  # e palavras que aparecem 10000 vezes ou menos
  dplyr::filter(!word %in% banned_words,
                stringr::str_length(word) &gt; 2,
                n &gt; 10000) </code></pre>
<pre class="r"><code>wordcloud2::wordcloud2(wc)</code></pre>
<div id="htmlwidget-1" style="width:672px;height:480px;" class="wordcloud2 html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"word":["2004","academia","acessorios","administracao","administradora","administrativo","administrativos","advocacia","advogados","agencia","agricola","agricolas","agricultores","agro","agropecuaria","agropecuarios","agua","alianca","alimenticios","alimentos","almeida","alto","alves","ambiental","amigos","andrade","antonio","aparecida","apoio","araujo","arquitetura","art","arte","artefatos","artes","artigos","artisticas","assembleia","assessoria","assistencia","assoc","associados","atacadista","auto","automacao","automotivo","automotivos","automoveis","bairro","bar","barbosa","barros","batista","bazar","bebidas","beleza","bem","beneficente","bens","boa","bom","borges","brasil","brasileira","brasileiro","cabeleireiros","cafe","caixa","calcados","campo","campos","car","cardoso","cargas","carlos","carnes","carvalho","casa","castro","center","central","centro","cia","civil","clinica","club","clube","colchoes","colegio","combustiveis","comerciais","comercial","comercio","comite","comunicacao","comunidade","comunitaria","comunitario","condominio","condutores","confeccao","confeccoes","confeitaria","conselho","consorcio","construcao","construcoes","construtora","consultoria","contabil","contabilidade","cooperativa","corretora","cosmeticos","costa","cristo","cruz","cultura","cultural","cunha","cursos","dados","decoracoes","desenvolvimento","design","deus","dias","digital","distribuicao","distribuidora","doces","drogaria","editora","educacao","educacional","eleicoes","eletrica","eletricos","eletro","eletronica","eletronicos","embalagens","empreendimentos","empreiteira","empresa","empresariais","empresarial","engenharia","ensino","equipamentos","escola","escolar","escritorio","espaco","esperanca","espirita","esporte","esportiva","esportivos","estacionamento","estado","estadual","estetica","evangelica","eventos","exportacao","express","farmacia","fernandes","ferragens","ferramentas","ferreira","festas","filho","financ","fisioterapia","fomento","formacao","francisco","freitas","fundacao","fundamental","futebol","garcia","gas","gerais","geral","gestao","gomes","goncalves","grafica","grande","gremio","grupo","guimaraes","hotel","idiomas","igreja","imobiliaria","imobiliarios","imoveis","importacao","importadora","incorporacoes","incorporadora","ind","individual","industria","industriais","industrial","infantil","informacao","informatica","instalacoes","instituto","investimentos","irmaos","jardim","jesus","joao","jose","junior","laboratorio","lanches","lanchonete","lar","leite","lima","limitada","limpeza","locacao","locacoes","locadora","logistica","loja","lopes","luiz","luz","machado","madeiras","maes","manutencao","mao","maquinas","maria","marketing","marques","martins","materiais","material","mecanica","medica","medicamentos","medicina","medico","medicos","melo","mendes","mercadinho","mercado","mercantil","mercearia","mestres","metais","metalurgica","minas","ministerio","moda","modas","montagem","montagens","monte","moradores","moraes","moreira","moto","motos","moura","moveis","mun","municipal","municipio","nacional","nascimento","negocios","neto","norte","nova","novo","nucleo","nunes","obra","obras","odontologia","odontologica","oficina","oliveira","organizacao","otica","ouro","outra","outro","outros","padaria","pais","panificadora","papelaria","participacoes","partido","paula","paulo","pecas","pedro","pentecostal","pequenos","pereira","perfumaria","pet","pinturas","pizzaria","planejamento","plasticos","pneus","ponto","porto","posto","pousada","povoado","presentes","prestacao","prestadora","preto","pro","processamento","producao","producoes","produtores","produtos","prof","profissional","projeto","projetos","promocoes","propaganda","publicidade","ramos","real","recreativa","recreativo","reformas","refrigeracao","regiao","reis","representacao","representacoes","residencial","restaurante","ribeiro","rio","rocha","rodoviarios","rodrigues","rosa","roupas","rurais","rural","s.a","santa","santana","santo","santos","sao","saude","seguranca","seguros","senhora","serra","service","servico","servicos","shop","silva","simples","sistemas","sitio","soares","social","sociedade","sol","solucoes","sousa","souza","spe","studio","sul","supermercado","tecidos","tecnica","tecnicos","tecnologia","teixeira","telecomunicacoes","terra","tintas","trabalhadores","trabalho","transportadora","transporte","transportes","treinamento","treinamentos","turismo","uniao","unico","unidade","utilidades","vale","varejista","veiculos","vendas","verde","vereador","vestuario","viagens","vida","video","vidros","vieira","vila","vista","visual","vitoria"],"freq":[57316,22859,78116,57344,32543,14430,26037,23712,49510,19640,14316,13405,16972,13123,30399,10290,18812,10459,41669,110480,28953,11506,34977,15124,34867,19986,35414,12369,35336,23335,19596,11023,20485,17973,13992,51958,15317,31471,126741,32620,23283,47105,12712,93421,10737,13421,16247,12378,28509,72958,18094,12194,31477,21505,40061,22994,10677,15543,26875,12627,17749,12489,99976,17635,11106,10028,19686,34793,53829,12150,18579,19489,13556,18012,22368,20927,29378,66265,14291,24618,20912,136066,293485,22936,84334,10132,70386,11429,11648,13028,63994,216468,1113913,58151,52073,33060,71595,20020,12285,13105,11993,139494,20974,53766,13065,116147,104199,84203,220698,22629,23820,36998,60076,35838,40560,18868,18010,11915,37127,10049,13394,12209,22878,52145,18092,47431,19688,12997,19157,108763,15736,33549,22906,37294,29484,56567,21870,17882,13405,16928,25022,23176,138747,25833,14768,13043,65717,94632,30952,70758,101251,75166,15944,15312,12171,16662,19996,16521,12230,15985,13593,14905,19822,54186,67132,43840,14275,19124,20854,14697,10672,41351,10904,17748,56590,14890,10958,15383,20577,16451,10757,15969,16567,11590,24994,14179,16915,36580,26719,19408,20376,18280,11052,26536,10083,14690,10471,109638,25162,72195,39706,51026,10256,12804,24125,16810,17606,227154,24914,30311,31142,22208,177061,20408,54919,17443,26742,25210,22855,28911,54873,17335,13786,26334,61115,11719,10832,39707,41304,26725,39518,16669,23864,29524,15720,22087,19709,14847,16577,22620,12213,52425,13623,40593,42847,28448,15718,30432,86279,28055,33009,28449,12565,12756,10524,53919,14027,14701,10385,24033,12102,38609,29707,10536,14332,15362,26961,24249,37523,11219,12899,11931,77146,12116,14909,13609,12139,10922,74431,60196,54729,11387,12919,13281,38288,10196,16254,56608,19164,12303,13748,14431,12725,12046,15714,11095,78157,15382,11590,10572,31826,49401,35223,24163,45499,25875,26393,124655,21791,11129,27692,96160,15370,29256,25514,38475,14564,12589,10043,22464,14511,17105,14010,10839,14242,37542,10186,12816,28561,28343,17354,10825,12600,10273,11798,45472,47551,128686,10666,10556,10459,40057,17582,10719,20172,13704,13315,10861,10580,15847,13992,13648,14929,72388,272888,12428,94023,28929,52754,23526,11000,37785,19413,60133,47538,17786,20935,53276,14174,20837,83952,94369,38013,33224,64442,15190,14526,17604,21712,614589,11684,126701,15243,34864,11270,19017,30828,90475,13041,52372,14588,57849,24790,11919,30575,22999,10702,23866,14732,64153,12295,21221,14916,13324,12801,14867,29624,47798,178973,23402,11128,52950,26294,23770,15622,13385,20706,27682,77206,12509,17126,32828,30961,23367,39979,16435,11564,19976,27982,11527,13419,12710],"fontFamily":"Segoe UI","fontWeight":"bold","color":"random-dark","minSize":0,"weightFactor":0.000161592512162081,"backgroundColor":"white","gridSize":0,"minRotation":-0.785398163397448,"maxRotation":0.785398163397448,"shuffle":true,"rotateRatio":0.4,"shape":"circle","ellipticity":0.65,"figBase64":null,"hover":null},"evals":[],"jsHooks":{"render":[{"code":"function(el,x){\n                        console.log(123);\n                        if(!iii){\n                          window.location.reload();\n                          iii = False;\n\n                        }\n  }","data":null}]}}</script>
<p>WordClouds e sua incrível relevância prática (ironia). Bom, podemos ver que empresas de serviços são comuns!</p>
</div>
<div id="quantidade-de-socios" class="section level2">
<h2>Quantidade de sócios</h2>
<p>Qual a distribuição de quantidade de sócios?</p>
<p>Para responder essa pergunta, considerei apenas sócios pessoa física. Não fiz filtros de qualificação. Mas também não saberia selecionar as qualificações corretas sobre a base de <code>qualificacao</code>.</p>
<table>
<thead>
<tr class="header">
<th align="left">Qtd. Sócios</th>
<th align="right">Empresas</th>
<th align="left">Proporção</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2</td>
<td align="right">5911971</td>
<td align="left">65.4%</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="right">2265100</td>
<td align="left">25.0%</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="right">551072</td>
<td align="left">6.1%</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="right">174558</td>
<td align="left">1.9%</td>
</tr>
<tr class="odd">
<td align="left">[5, 15]</td>
<td align="right">134898</td>
<td align="left">1.5%</td>
</tr>
<tr class="even">
<td align="left">[16, 584]</td>
<td align="right">5714</td>
<td align="left">0.1%</td>
</tr>
</tbody>
</table>
<p>Dois terços das empresas são formadas por dois sócios e 90% das empresas são formadas por um ou dois sócios.</p>
<p>Fiquei interessado em saber quais empresas tem tantos sócios. Além da EY, não conheço nenhuma das empresas abaixo. O que dá para notar é que boa parte delas está ligada ao ramo médico.</p>
<table>
<colgroup>
<col width="93%" />
<col width="6%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">nome_empresarial</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">COMED - CORPO MEDICO LTDA</td>
<td align="right">584</td>
</tr>
<tr class="even">
<td align="left">QUIRON PRONTO SOCORRO LTDA - ME</td>
<td align="right">481</td>
</tr>
<tr class="odd">
<td align="left">SIMEA - SOCIEDADE INTEGRADA MEDICA DO AMAZONAS LTDA</td>
<td align="right">391</td>
</tr>
<tr class="even">
<td align="left">NOVA FAMILIA LTDA - EPP</td>
<td align="right">371</td>
</tr>
<tr class="odd">
<td align="left">SOCIEDADE BAURUENSE DE PRESTACAO DE SERVICOS MEDICOS SOBAME</td>
<td align="right">347</td>
</tr>
<tr class="even">
<td align="left">ERNST &amp; YOUNG ASSESSORIA EMPRESARIAL LTDA</td>
<td align="right">332</td>
</tr>
<tr class="odd">
<td align="left">UNIAO CONSULTORIA LTDA</td>
<td align="right">285</td>
</tr>
<tr class="even">
<td align="left">INSTITUTO MEDICO DE CLINICA E PEDIATRIA DO ESTADO DO AMAZONAS S/S LTDA</td>
<td align="right">284</td>
</tr>
<tr class="odd">
<td align="left">UROLOGISTAS DO ESTADO DO RIO DE JANEIRO LTDA</td>
<td align="right">281</td>
</tr>
<tr class="even">
<td align="left">SNC &amp; CIA ADMINISTRACAO DE BENS</td>
<td align="right">277</td>
</tr>
</tbody>
</table>
</div>
<div id="pessoas-com-mais-empresas" class="section level2">
<h2>Pessoas com mais empresas</h2>
<p>Quem são as pessoas que fazem parte do maior número de empresas? Temos abaixo uma lista dos 20 mais. Obviamente muitos desses nomes são homônimos. O primeiro nome da lista que me parece pouco provável de ter homônimos é o Renato Gamba Rocha Diniz. Também fiquei interessado nesse “Não Consta na Base”…</p>
<table>
<thead>
<tr class="header">
<th align="left">nome</th>
<th align="right">n_empresas</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">JOSE CARLOS DA SILVA</td>
<td align="right">2084</td>
</tr>
<tr class="even">
<td align="left">JOAO BATISTA DA SILVA</td>
<td align="right">1518</td>
</tr>
<tr class="odd">
<td align="left">LUIZ CARLOS DA SILVA</td>
<td align="right">1488</td>
</tr>
<tr class="even">
<td align="left">MARIA APARECIDA DA SILVA</td>
<td align="right">1487</td>
</tr>
<tr class="odd">
<td align="left">ANTONIO CARLOS DA SILVA</td>
<td align="right">1372</td>
</tr>
<tr class="even">
<td align="left">JOSE CARLOS DOS SANTOS</td>
<td align="right">1339</td>
</tr>
<tr class="odd">
<td align="left">MARIA JOSE DA SILVA</td>
<td align="right">1119</td>
</tr>
<tr class="even">
<td align="left">CARLOS ALBERTO DA SILVA</td>
<td align="right">1091</td>
</tr>
<tr class="odd">
<td align="left">JOSE CARLOS DE OLIVEIRA</td>
<td align="right">1055</td>
</tr>
<tr class="even">
<td align="left">MARCOS ANTONIO DA SILVA</td>
<td align="right">1038</td>
</tr>
<tr class="odd">
<td align="left">NAO CONSTA NA BASE</td>
<td align="right">1035</td>
</tr>
<tr class="even">
<td align="left">JOSE ANTONIO DA SILVA</td>
<td align="right">1017</td>
</tr>
<tr class="odd">
<td align="left">RENATO GAMBA ROCHA DINIZ</td>
<td align="right">946</td>
</tr>
<tr class="even">
<td align="left">JOSE ROBERTO DA SILVA</td>
<td align="right">907</td>
</tr>
<tr class="odd">
<td align="left">LUIZ CARLOS DOS SANTOS</td>
<td align="right">882</td>
</tr>
<tr class="even">
<td align="left">PAULO ROBERTO DA SILVA</td>
<td align="right">839</td>
</tr>
<tr class="odd">
<td align="left">JOSE PEREIRA DA SILVA</td>
<td align="right">804</td>
</tr>
<tr class="even">
<td align="left">JOAO BATISTA DE OLIVEIRA</td>
<td align="right">770</td>
</tr>
<tr class="odd">
<td align="left">RENATA ROSSI CUPPOLONI RODRIGUES</td>
<td align="right">766</td>
</tr>
<tr class="even">
<td align="left">ANTONIO CARLOS DOS SANTOS</td>
<td align="right">762</td>
</tr>
</tbody>
</table>
</div>
<div id="sexo-dos-socios" class="section level2">
<h2>Sexo dos sócios</h2>
<p>Aqui vamos usar o pacote <a href="https://github.com/meirelesff/genderBR"><code>genderBR</code></a> para pegar o sexo mais provável de todas as pessoas. No total, temos 11.388.120 nomes únicos na base (isso subestima a quantidade de pessoas, por conta de homônimos).</p>
<p>Para a análise do sexo dos sócios, tivemos de retirar 392.533 nomes em que o <code>genderBR</code> não foi capaz de estimar o sexo. Isso corresponde a 2,2% da base. Creio que não seja absurdo afirmar que esses valores faltantes influenciam no resultado. Nessa análise, se uma pessoa tem 2 duas ou mais empresas, ela é contada 2 ou mais vezes.</p>
<p>Minha hipótese era que teríamos mais homens como sócios de empresas, por razões históricas/culturais (queremos mudar isso!). Infelizmente a hipótese foi confirmada: 3/5 dos sócios são homens. Claro que essa análise precisa ser refinada pela qualificação e pela repetição de pessoas em empresas distintas.</p>
<pre class="r"><code>sexo_socios &lt;- socios %&gt;% 
  # apenas pessoas físicas
  dplyr::filter(indicador_cpf_cnpj == &quot;2&quot;) %&gt;% 
  # extrai primeiro nome
  dplyr::mutate(primeiro_nome = stringr::str_extract(nome, &quot;[^ ]+&quot;)) %&gt;%
  # conta primeiro nome
  dplyr::count(primeiro_nome) %&gt;%
  # estima a probabilidade de ser do sexo feminino
  dplyr::mutate(sexo = genderBR::get_gender(primeiro_nome, prob = TRUE)) %&gt;% 
  # retira estimações NA (cuidado!)
  dplyr::filter(!is.na(sexo))</code></pre>
<pre class="r"><code>library(ggplot2)
grafico &lt;- sexo_socios %&gt;% 
  # É feminino se sexo &gt; 0.5 (mais de 50% feminino observado no IBGE)
  dplyr::mutate(sexo = dplyr::if_else(sexo &gt; .5, &quot;Fem&quot;, &quot;Masc&quot;)) %&gt;% 
  dplyr::group_by(sexo) %&gt;% 
  dplyr::summarise(total = sum(n)) %&gt;% 
  dplyr::arrange(dplyr::desc(total)) %&gt;%
  # adiciona proporção em %
  dplyr::mutate(prop = scales::percent(total / sum(total))) %&gt;% 
  # aqui começa o gráfico
  ggplot(aes(x = sexo, y = total/1000, fill = sexo)) +
  geom_col() +
  # daqui pra baixo é só estética
  coord_flip() +
  geom_text(aes(label = prop), size = 6, hjust = 1, vjust = -1) +
  theme_minimal(16) +
  ggtitle(&quot;Quantidade de empresas por sexo&quot;) +
  labs(x = &quot;Sexo&quot;, y = &quot;Total (milhares)&quot;)

grafico</code></pre>
<p><img src="/blog/2018-05-13-rfbCNPJ/empresas_sexo.png" /><!-- --></p>
</div>
</div>
<div id="wrap-up" class="section level1">
<h1>Wrap-up</h1>
<ul>
<li>O pacote <code>rfbCNPJ</code> serve para organizar os dados de CNPJ da Receita Federal.</li>
<li>Use a função <code>rfb_import()</code> para ler os binários prontinhos para leitura diretamente do dropbox.</li>
<li>Além de descobrir todos os 9.048.917 CNPJs e 11.388.120 nomes únicos de pessoas, podemos fazer algumas análises exploratórias com esses dados.</li>
</ul>
<div id="agradecimentos" class="section level2">
<h2>Agradecimentos</h2>
<p>Aos amigos da curso-r.com e agregados, que me orientaram a criar a função <code>rfb_import()</code>.</p>
</div>
<div id="links" class="section level2">
<h2>Links</h2>
<p>Veja também o <a href="http://brasil.io">Brasil.io</a> do <a href="https://github.com/turicas">Turicas</a>, que tem os mesmos arquivos para download.</p>
<p>É isso. Happy coding ;)</p>
</div>
</div>
